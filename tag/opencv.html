<!DOCTYPE html>
<html lang="en">
<head>
        <title>machine burning - opencv</title>
        <meta charset="utf-8" />
        <link rel="icon" type="image/png" href="../theme/images/fire.png">
        <link rel="stylesheet" href="../theme/css/main.css" type="text/css" />
        <link href="../feed.rss" type="application/rss+xml" rel="alternate" title="machine burning RSS Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="../css/ie.css"/>
                <script src="../js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="../css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <div class="social">
				    <a href="../feed.rss" rel="alternate">
					    <span></span>
				    </a>

				    <a href="https://www.linkedin.com/in/gbrunoro">
					    <span></span>
				    </a>
				    <a href="http://github.com/brunoro">
					    <span></span>
				    </a>
				    <a href="http://last.fm/user/gbrunoro">
					    <span></span>
				    </a>
				    <a href="http://soundcloud.com/beise">
					    <span></span>
				    </a>
                </div>
                <h1><a href=".."><span id="title0">machine burning</span><span id="title1">machine burning</span><span id="title2">machine burning</span> </a></h1>
                </ul></nav>
        </header><!-- /#banner -->
        
        

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="../building-ocaml-and-c-mixed-projects-with-ocaml-makefile.html">Building OCaml and C++ mixed projects with OCaml-Makefile</a></h1> 
<div class="post-info">
        <abbr class="published" title="2016-10-20T00:00:00+02:00">
                2016-10-20
        </abbr>

<p>in <a href="../category/ocaml.html">ocaml</a>. </p>
<p>tags: <a href="../tag/ocaml.html">ocaml</a><a href="../tag/opencv.html">opencv</a></p></div><!-- /.post-info --><p>One difficulty I faced in my recent adventures with OCaml was figuring out how to organize and build my tiny toy projects, which have some custom C++ code in the mix. 
There's a <a href="https://github.com/ocaml/ocamlbuild/blob/master/manual/manual.adoc#pros-cons-and-alternatives">lot of fragmentation</a>
in the OCaml ecosystem for build systems, and while <a href="https://github.com/ocaml/ocamlbuild">ocamlbuild</a> seems to be the most widely used tool,
there's no consensus on the community of an <em>official</em> solution. In the midst of all that mess, my only
goal was to find something that required the minimum amount of configuration for me to get something running
and still keep a mildly organized codebase. 
The piece of software that met my requirements was <a href="https://github.com/mmottl/ocaml-makefile">OCaml-Makefile</a>.</p>
<p>It's very simple to use it: copy that OCaml-Makefile into the root of your project and create your Makefile containing
<code>-include OCamlMakefile</code> as the last line, and specify some variables:</p>
<ul>
<li><code>SOURCES</code>: the OCaml and C source files.</li>
<li><code>RESULT</code>: the name of the resuting product.</li>
<li><code>PACKS</code>: <a href="https://github.com/ocaml/opam/">opam</a> packages that should be linked.</li>
</ul>
<p>That done, building binaries and libraries in native or bytecode, with debugging or profiling directives enabled if necessary, 
is as easy as invoking a make target. The README of the OCamlMakefile goes through most of the use cases of the tool,
but I still faced some minor trouble when trying to compile a piece of software that contained some C++ source files and was
linked with C libraries -- and that's why I'm writing this post.</p>
<p>It turns out that there are two more important variables to take care of when compiling and linking C++ libs:</p>
<ul>
<li><code>CXXFLAGS</code>: the include path of headers used in your C++ code. The output of <code>pkg-config --cflags</code>. Not adding the correct <code>-I</code> flags here will result in a compile time error.</li>
<li><code>CLIBS</code>: the libraries used while linking your executable, without the <code>-l</code> part. As you're using C++ code remember to add <code>c++</code> (from <code>-lc++</code>) here. Missing libs here will result in a <code>Undefined symbols for architecture x86_64:</code> kind of error <em>at runtime</em>.</li>
</ul>
<p>I uploaded <a href="https://github.com/brunoro/webcaml">webcaml</a> as an example project with this setup that uses the <a href="http://opencv.org/">OpenCV C++</a> interface through ctypes and <a href="https://libsdl.org/">SDL2</a> through <a href="http://erratique.ch/software/tsdl">tsdl</a> to show a webcam feed (a herculean task by itself without the help of some established codebase). The approach used to interface with C++ using is the one described in <a href="https://github.com/ocamllabs/ocaml-ctypes/issues/187">this github issue</a>.</p>
<p><a href="https://twitter.com/elbeise/status/786926310929076224"><img src="https://pbs.twimg.com/tweet_video_thumb/Cuu5OEKWYAAthVT.jpg"></a></p>                </article>
            </aside><!-- /#featured -->
        <section id="extras" class="body">
       </section><!-- /#extras -->

        <footer id="about" class="body">
            <p>Powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>; theme based on <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a></p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-32411032-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>
</body>
</html>