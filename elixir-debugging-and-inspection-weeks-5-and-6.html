<!DOCTYPE html>
<html lang="en">
<head>
        <title>Elixir: Debugging and Inspection - weeks 5 and 6</title>
        <meta charset="utf-8" />
        <link rel="icon" type="image/png" href="./theme/images/fire.png">
        <link rel="stylesheet" href="./theme/css/main.css" type="text/css" />
        <link href="./feed.rss" type="application/rss+xml" rel="alternate" title="machine burning RSS Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="./css/ie.css"/>
                <script src="./js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="./css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <div class="social">
				    <a href="./feed.rss" rel="alternate">
					    <span></span>
				    </a>

				    <a href="https://github.com/brunoro">
					    <span></span>
				    </a>
				    <a href="https://twitter.com/elbeise">
					    <span></span>
				    </a>
				    <a href="https://instagram.com/elbeise">
					    <span></span>
				    </a>
				    <a href="https://beise.bandcamp.com/">
					    <span></span>
				    </a>
				    <a href="https://mixcloud.com/beise">
					    <span></span>
				    </a>
                </div>
                <div>
                  <a href=".">
                    <img id="title-logo" src="./theme/images/fire.png"/>
                    <span id="title0">machine burning</span>
                    <!-- <span id="title1">machine burning</span>
                    <span id="title2">machine burning</span> -->
</a></h1>
                </ul></nav>
        </header><!-- /#banner -->
        
<section id="content" class="body">    
<article>
        <header> <h1 class="entry-title"><a href=""
        rel="bookmark" title="Permalink to Elixir: Debugging and Inspection - weeks 5 and 6">Elixir: Debugging and Inspection - weeks 5 and 6</a></h1>  </header>
<div class="post-info">
        <abbr class="published" title="2013-07-29T00:00:00-03:00">
                2013-07-29
        </abbr>

<p>in <a href="./category/gsoc2013.html">gsoc2013</a>. </p>
<p>tags: <a href="./tag/gsoc2013.html">gsoc2013</a><a href="./tag/elixir.html">elixir</a></p></div><!-- /.post-info -->        <div class="entry-content">
        <p>The last two weeks have been quite busy Elixir debugging: the project has seen a fair amount of changes 
on the design side and many practical issues came up. 
All that had to do with implementing debugging of programs using multi-processing directives, 
which are the most important and distinctive features of Elixir.</p>
<h3>Evaluators, Coordinators and Runners</h3>
<p>On our previous design, an <code>Evaluator</code> would responsible for keeping the state of a current process and evaluate code on its behalf.
That idea worked quite well when not dealing with message sending for one basic reason: with code actually running on another process,
the PID (process identifier) and the mailbox being used for message passing wouldn't be that of the process being evaluated.
On that context, switching from <strong>interpreted</strong> to <strong>native</strong> running modes would be very tricky, as all PIDs would have to be translated
from host to Evaluator and vice-versa.</p>
<p>A <code>Coordinator</code>/<code>Runner</code> structure would fit much better the problem: the first process would be the bridge between the user interface
and the running code, keeping the state of the code evaluation for the possiblity of inspection; 
the latter would evaluate it's own expressions while waiting for the approval of its <code>Coordinator</code>.</p>
<h3>Such a pid thing to do</h3>
<p>A practical problem faced recently was injecting PID literals on an Elixir tree -- there's no thing such as PID literals.
The approach used by the interpreter being implemented is to depth-first search on the quoted expressions and backtrack
the values of sub-expressions by replacing them on the tree with the result of their evaluations.
So, when the value of an expression is a process identifier, <code>:elixir.eval_quoted</code> would return something that looks like
<code>#PID&lt;0.27.0&gt;</code>, which is clearly not valid Elixir syntax and would yield the infamous <code>invalid quoted expression: #PID&lt;0.27.0&gt;</code>
when interpreted.</p>
<p>The solution to that problem would require a bit of name mangling and corner case handling.
PIDs have to be provided to the binding just after they're evaluated, as there's no literal representation for them<sup>1</sup>, so
with some name mangling we generate a very distinctive variable name for a process identifier and filter everything coming
off our slick <code>:elixir_code.eval_quoted</code> calls.
In the end, turning <code>#PID&lt;0.27.0&gt;</code> into a variable called <code>__PID_0_27_0__</code> bound to the PID's value (and not a representation) pretty
much solves the problem.</p>
<p><sub><sup>1</sup>well, as a matter of fact one could use a char list as a PID literal using the <code>list_to_pid/1</code> and <code>pid_to_list/1</code> functions,
but that'd just make things get more complex.</sub></p>
        </div><!-- /.entry-content -->

</article>
</section>
        <section id="extras" class="body">
       </section><!-- /#extras -->

        <footer id="about" class="body">
            <p>Powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>; theme based on <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a></p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-32411032-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>
</body>
</html>